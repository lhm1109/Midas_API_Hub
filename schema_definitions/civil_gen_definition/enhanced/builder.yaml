# Enhanced Schema - Builder Tab Specific Rules
# Enhanced Schemaì˜ Builder Tab ì „ìš© ê·œì¹™

version: "1.0"
extends: "./ui-rules.yaml"

# ============================================================================
# Enhanced Schema Detection Markers
# Enhanced Schemaë¥¼ ê°ì§€í•˜ê¸° ìœ„í•œ ë§ˆì»¤ë“¤
# ============================================================================
enhancedSchemaMarkers:
  - "x-ui"
  - "x-transport"
  - "x-enum-by-type"
  - "x-node-count-by-type"

# ============================================================================
# Wrapper Rules (JSON ë˜í¼ ê·œì¹™)
# URI íŒ¨í„´ì— ë”°ë¼ JSONì„ ì–´ë–¤ ë˜í¼ë¡œ ê°ìŒ€ì§€ ê²°ì •
# ============================================================================
wrapperRules:
  # db/ë¡œ ì‹œì‘í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸
  - pattern: "^/db/"
    wrapper: "Assign"
    description: "Database endpoints use Assign wrapper"
  
  # post/ë¡œ ì‹œì‘í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸
  - pattern: "^/post/"
    wrapper: "Argument"
    description: "Post endpoints use Argument wrapper"
  
  # doc/ë¡œ ì‹œì‘í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸
  - pattern: "^/doc/"
    wrapper: "Argument"
    description: "Documentation endpoints use Argument wrapper"
  
  # ê¸°ë³¸ê°’ (íŒ¨í„´ì´ ì—†ìœ¼ë©´)
  - pattern: ".*"
    wrapper: null
    description: "Default: no wrapper"

# ============================================================================
# Form Layout
# í¼ ë ˆì´ì•„ì›ƒ êµ¬ì¡°
# ============================================================================
formLayout:
  container:
    className: "bg-gradient-to-br from-purple-950/50 to-zinc-900 border-2 border-purple-800/50 rounded-lg p-6"
  
  title:
    text: "Schema-Based Fields"
    icon: "ğŸ“"
    className: "text-lg font-semibold mb-4"
    badges:
      - text: "Instance: {instanceKey}"
        className: "px-2 py-0.5 bg-blue-600/20 text-blue-400 text-[10px] rounded border border-blue-600/50"
        condition: "useAssignWrapper"
      - text: "From Spec Tab"
        className: "px-2 py-0.5 bg-green-600/20 text-green-400 text-[10px] rounded border border-green-600/50"
        condition: "hasEnhancedSchema"
  
  fieldContainer:
    className: "space-y-4"

# ============================================================================
# Section Headers
# ì„¹ì…˜ í—¤ë” (x-ui.group)
# ============================================================================
sectionHeaders:
  enabled: true
  
  style:
    container: "pt-4 pb-2 border-t-2 border-cyan-800/50 first:pt-0 first:border-t-0"
    title: "text-sm font-semibold text-cyan-400 flex items-center gap-2"
    icon: "ğŸ“‹"
  
  detectBy: "__section_"  # í•„ë“œëª…ì´ ì´ê²ƒìœ¼ë¡œ ì‹œì‘í•˜ë©´ ì„¹ì…˜ í—¤ë”

# ============================================================================
# Field Rendering
# í•„ë“œë³„ ë Œë”ë§ ê·œì¹™
# ============================================================================
fieldRendering:
  # ì¼ë°˜ í•„ë“œ
  standard:
    label:
      source: "description"  # description ìš°ì„  (x-ui.labelì´ ë“¤ì–´ìˆìŒ)
      fallback: "name"
      className: "text-sm flex items-center gap-2"
      showRequired: true
      showType: true
    
    input:
      className: "bg-zinc-800 border-zinc-700"
      showPlaceholder: true
      placeholderSource: "placeholder"  # field.placeholder ì‚¬ìš©
  
  # Enum í•„ë“œ (TYPEë³„ ë™ì )
  enum:
    component: "Select"
    dynamic: true  # TYPE ë³€ê²½ ì‹œ ì˜µì…˜ ì—…ë°ì´íŠ¸
    triggerField: "TYPE"
    showEmptyOption: false
    optionFormat: "value"
  
  # Array í•„ë“œ (x-node-count-by-type íŒíŠ¸)
  array:
    component: "Textarea"
    parseJson: true
    formatOnBlur: true
    showHint: true  # x-node-count-by-type í‘œì‹œ
  
  # Object í•„ë“œ (ì¤‘ì²©)
  object:
    accordion: true
    checkbox: true
    expandByDefault: false
    style:
      border: "border-zinc-700 rounded-md bg-zinc-900/50"
      header: "flex items-center gap-2 p-3 bg-zinc-800/50"
      content: "p-4 space-y-3 bg-zinc-900/30"
      childBorder: "pl-4 border-l-2 border-zinc-700"

# ============================================================================
# Hints Display
# íŒíŠ¸ í‘œì‹œ (x-value-constraint, x-node-count-by-type)
# ============================================================================
hintsDisplay:
  enabled: true
  position: "below"  # below | inline
  
  sources:
    - type: "x-value-constraint"
      icon: "ğŸ’¡"
      style: "text-[10px] text-amber-400 italic"
    
    - type: "x-node-count-by-type"
      icon: "ğŸ“Š"
      style: "text-[10px] text-cyan-400 italic"
    
    - type: "placeholder"
      icon: "â„¹ï¸"
      style: "text-[10px] text-zinc-500 italic"
  
  format: "{icon} {message}"

# ============================================================================
# Dynamic Behavior
# ë™ì  ë™ì‘ (ìë™ ê°ì§€)
# ============================================================================
dynamicBehavior:
  # visibleWhen ì§€ì›
  conditionalVisibility:
    enabled: true
    # ğŸ¯ triggerFieldsëŠ” ìŠ¤í‚¤ë§ˆì˜ x-ui.visibleWhenì—ì„œ ìë™ìœ¼ë¡œ ê°ì§€ë©ë‹ˆë‹¤
    # extractTriggerFields() í•¨ìˆ˜ê°€ ìŠ¤í‚¤ë§ˆë¥¼ íŒŒì‹±í•˜ì—¬ ì‚¬ìš©ëœ ëª¨ë“  í•„ë“œë¥¼ ì¶”ì¶œ
    # ì˜ˆ: TYPE, STYPE, iMETHOD, bUSE, etc.
    autoDetect: true
    evaluateOn: "change"
    hideMode: "remove"  # remove | hide
  
  # x-enum-by-type ì§€ì›
  dynamicEnum:
    enabled: true
    triggerField: "TYPE"
    updateOn: "change"
    preserveValue: false  # TYPE ë³€ê²½ ì‹œ ê°’ ì´ˆê¸°í™”
  
  # allOf ì¡°ê±´ë¶€ required
  dynamicRequired:
    enabled: true
    triggerField: "TYPE"
    updateOn: "change"
    showIndicator: true

# ============================================================================
# Input Behavior
# ì…ë ¥ ë™ì‘ ê·œì¹™
# ============================================================================
inputBehavior:
  # ìë™ ì €ì¥
  autoSave:
    enabled: false
    debounce: 1000
  
  # ì…ë ¥ ê²€ì¦ (Standard + APP ë ˆì´ì–´)
  validation:
    trigger: "onChange"
    layers:
      standard:
        enabled: true
        badge: "STD"
      appLayer:
        enabled: true
        badge: "APP"
    showErrors: "immediate"
  
  # ê¸°ë³¸ê°’ ì²˜ë¦¬
  defaultValues:
    applyOnMount: true
    clearOnReset: true
  
  # íƒ€ì… ë³€í™˜
  typeCoercion:
    number: true
    boolean: true
    array: true

# ============================================================================
# Instance Management (Assign Wrapper)
# ì¸ìŠ¤í„´ìŠ¤ ê´€ë¦¬
# ============================================================================
instanceManagement:
  enabled: true
  wrapper: "Assign"
  defaultInstance: "1"
  
  ui:
    container:
      className: "bg-gradient-to-br from-blue-950/50 to-zinc-900 border-2 border-blue-800/50 rounded-lg p-4"
    
    title:
      text: "Assign Instances"
      icon: "ğŸ”¢"
      className: "text-sm font-semibold"
    
    buttons:
      add:
        text: "+ Add Instance"
        className: "h-7 text-xs bg-blue-600 hover:bg-blue-500"
      
      remove:
        icon: "ğŸ—‘ï¸"
        className: "p-1 rounded text-red-400 hover:bg-red-900/20"
      
      select:
        activeClassName: "bg-blue-600 text-white"
        inactiveClassName: "bg-zinc-800 text-zinc-400 hover:bg-zinc-700"

# ============================================================================
# JSON Preview
# JSON ë¯¸ë¦¬ë³´ê¸° ì„¤ì •
# ============================================================================
jsonPreview:
  enabled: true
  modes:
    - annotated
    - monaco
  
  defaultMode: "annotated"
  
  annotated:
    showBadges: true
    colorScheme:
      key: "text-red-400"
      string: "text-emerald-400"
      number: "text-green-400"
      boolean: "text-orange-400"
      null: "text-purple-400"
  
  monaco:
    editable: true
    minimap: true
    applyButton:
      text: "âœ¨ Apply to Form"
      className: "bg-green-600 hover:bg-green-500"

# ============================================================================
# Test Case Management
# í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ê´€ë¦¬
# ============================================================================
testCases:
  enabled: true
  
  list:
    showTimestamp: true
    showDescription: true
    inlineRename: true
  
  buttons:
    save:
      new: "Save as New Test Case"
      update: "Update Test Case"
      icon: "ğŸ’¾"
    
    load:
      auto: true
    
    delete:
      confirm: true
      icon: "ğŸ—‘ï¸"

# ============================================================================
# Validation Messages
# ê²€ì¦ ë©”ì‹œì§€ (Enhanced ì „ìš© ì¶”ê°€)
# ============================================================================
validationMessages:
  required: "{field} is required for {TYPE}"
  invalidType: "{field} must be a {type}"
  invalidEnum: "{field} must be one of: {values} (for {TYPE})"
  minItems: "{field} must have at least {min} items"
  maxItems: "{field} must have at most {max} items"
  nodeCount: "{field} must have {count} nodes for {TYPE}"
  valueConstraint: "{field}: {constraint}"


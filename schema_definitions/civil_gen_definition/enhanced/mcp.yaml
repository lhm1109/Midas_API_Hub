# ============================================================================
# MCP RULES - MCP ì„œë²„ ì „ìš© ê·œì¹™
# ============================================================================
# MCP ì„œë²„ê°€ ì§€ì¼œì•¼ í•  ë³´ì•ˆ, IO, ê²°ì •ë¡ , ê²€ì¦ ê·œì¹™
# ìŠ¤í‚¤ë§ˆ ì˜ë¯¸ëŠ” shared.yamlì—ì„œ ì°¸ì¡°
# ============================================================================

version: "1.0.0"
extends: "./shared.yaml"

# ============================================================================
# SECURITY - ë³´ì•ˆ ì •ì±…
# ============================================================================
security:
  # ì½ê¸° í—ˆìš© ê²½ë¡œ
  readAllowlist:
    - "schema_definitions/**/*.{yaml,yml}"
    - "schema_definitions/**/*.json"
  
  # ì“°ê¸° í—ˆìš© ê²½ë¡œ
  writeAllowlist:
    - "generated_schemas/**/*.json"
  
  # ì°¨ë‹¨ ì •ì±…
  deny:
    pathTraversal: true      # ../ ì°¨ë‹¨
    symlinks: true           # ì‹¬ë³¼ë¦­ ë§í¬ ì°¨ë‹¨
    absolutePaths: true      # ì ˆëŒ€ ê²½ë¡œ ì°¨ë‹¨ (allowlist ì™¸)

# ============================================================================
# DETERMINISM - ê²°ì •ë¡ ì  ì¶œë ¥ ë³´ì¥
# ============================================================================
determinism:
  # JSON ì¶œë ¥ ê·œì¹™
  json:
    sortObjectKeys: true     # í‚¤ ì•ŒíŒŒë²³ ì •ë ¬
    indent: 2
    lineEnding: "LF"         # CRLF | LF
  
  # ë°°ì—´ ì²˜ë¦¬
  array:
    preserveOrder: true      # ì›ë³¸ ìˆœì„œ ìœ ì§€
  
  # íƒ€ì… ê°•ì œ ë³€í™˜ ê¸ˆì§€
  forbidTypeCoercion: true   # "1" â†’ 1 ë³€í™˜ ê¸ˆì§€
  
  # YAML Alias ì²˜ë¦¬
  yamlAliasPolicy: "expand"  # expand | preserve | reject

# ============================================================================
# VALIDATION PIPELINE - ê²€ì¦ íŒŒì´í”„ë¼ì¸
# ============================================================================
validation:
  # Enum ê·œì¹™
  enum:
    integerMustUseOneOf: true
    autoConvert:
      enabled: true
      from: "enum"
      to: "oneOf"
      fallbackLabel: "Option {value}"
  
  # êµ¬ì¡° ê²€ì¦
  structure:
    requireSchema: 
      enabled: true
      value: "http://json-schema.org/draft-07/schema#"
    recommendTitle:
      enabled: true
      level: "warning"
    requiredFieldsExist:
      enabled: true
      message: "requiredì— ìˆëŠ” í•„ë“œê°€ propertiesì— ì—†ìŠµë‹ˆë‹¤"
  
  # íƒ€ì… ê²€ì¦
  type:
    prefixMatch:
      enabled: true
      # ê·œì¹™ì€ shared.yamlì˜ typeInferenceRegistry ì°¸ì¡°

# ============================================================================
# TRANSFORM RULES - ë³€í™˜ ê·œì¹™
# ============================================================================
transform:
  # ë£¨íŠ¸ ë˜í¼ í‚¤ ì œê±°
  unwrapRootKey:
    enabled: true
    extractTitle: true
    preserveMetadata:
      - "description"
      - "x-ui"
      - "x-transport"
  
  # Unknown key ì²˜ë¦¬
  unknownKeys:
    action: "passthrough"    # passthrough | remove | error
    collect: true            # metaì— ê¸°ë¡
    
  # x-* ë§ˆì»¤ ì²˜ë¦¬
  markers:
    # shared.yamlì˜ markerRegistry ì°¸ì¡°
    unknownMarker: "passthrough"  # passthrough | warn | error

# ============================================================================
# FIELD NAMING RULES - í•„ë“œ ë„¤ì´ë° ê·œì¹™ (AI ìŠ¤í‚¤ë§ˆ ìƒì„±ìš©)
# ============================================================================
# ğŸ“Œ AIê°€ ìŠ¤í‚¤ë§ˆ ìƒì„± ì‹œ ì´ ê·œì¹™ì„ ì°¸ì¡°í•˜ì—¬ ì¶•ì•½í˜• í‚¤ ì´ë¦„ì„ ì‚¬ìš©í•´ì•¼ í•¨
fieldNaming:
  # ğŸ”¥ ìŠ¤íƒ€ì¼ ê°€ì´ë“œ
  style:
    case: "UPPER_SNAKE"       # UPPER_SNAKE | camelCase | PascalCase
    maxLength: 12             # ìµœëŒ€ 12ì ê¶Œì¥
    abbreviateCommonWords: true
  
  # ğŸ”¥ ì ‘ë‘ì‚¬ ê·œì¹™ (íƒ€ì… ì¶”ë¡ )
  prefixes:
    i: "integer"              # iTENDON_TYPE, iCONSTR_TYPE
    s: "string"               # sDESIGN_CODE, sTYPE
    d: "number"               # dEXPOSURE_FACTOR, dANGLE
    b: "boolean"              # bUSE_LIMIT, bFLEX_CHECK
    n: "number"               # nVALUE (legacy)
    arr: "array"              # arrNODE, arrVALUES
  
  # ğŸ”¥ ì¶•ì•½ì–´ ì‚¬ì „ (AI ìƒì„± ì‹œ í™œìš©)
  abbreviations:
    # ê³µí†µ ì•½ì–´
    Construction: "CONSTR"
    Combination: "COMB"
    Combinations: "COMBS"
    Principal: "PRINC"
    Flexural: "FLEX"
    Strength: "STR"
    Service: "SVC"
    Factored: "FACT"
    Maximum: "MAX"
    Minimum: "MIN"
    Shear: "SHEAR"
    Torsion: "TORS"
    Combined: "COMB"
    Check: "CHK"
    Stress: "STRS"
    Prestressing: "PREST"
    Tendons: "TEND"
    Stage: "STG"
    Loads: "LD"
    Load: "LD"
    Value: "VAL"
    Factor: "FACT"
    Exposure: "EXP"
    Type: "TYPE"
    Class: "CLS"
    Code: "CODE"
    Design: "DES"
    Condition: "COND"
    Corrosive: "CORR"
    Relaxation: "RLX"
    Relieved: "RLV"
    Segmental: "SEG"
    Number: ""                # ìƒëµ (NODE = Node No.)
    
  # ğŸ”¥ ì˜ˆì‹œ ë§¤í•‘ (ê¸´ ì´ë¦„ â†’ ì¶•ì•½ ì´ë¦„)
  examples:
    # Output Parameters - Factored Loads
    - long: "bCombinedShearAndTorsionCheck"
      short: "bCOMB_SHEAR_TORS"
      label: "Combined Shear and Torsion Check"
      
    - long: "bFlexuralStrengthCheck"
      short: "bFLEX_STR_CHK"
      label: "Flexural Strength Check"
      
    - long: "bShearStrengthCheck"
      short: "bSHEAR_STR_CHK"
      label: "Shear Strength Check"
    
    # Output Parameters - Service Loads
    - long: "bStressByConstructionStage"
      short: "bSTRS_CONSTR"
      label: "Stress by Construction Stage"
      
    - long: "bStressByServiceLoadCombinations"
      short: "bSTRS_SVC_COMB"
      label: "Stress by Service Load Combinations"
      
    - long: "bStressInPrestressingTendons"
      short: "bSTRS_PREST"
      label: "Stress in Prestressing Tendons"
      
    - long: "bPrincipalStressByConstructionStage"
      short: "bPRINC_CONSTR"
      label: "Principal Stress by Construction Stage"
      
    - long: "bPrincipalStressByMaxShear"
      short: "bPRINC_MAX_SHEAR"
      label: "Principal Stress by Service Load (Max Shear)"
      
    - long: "bPrincipalStressByMaxTorsion"
      short: "bPRINC_MAX_TORS"
      label: "Principal Stress by Service Load (Max Torsion)"
    
    - long: "bCrackCheck"
      short: "bCRACK_CHK"
      label: "Crack Check"
    
    # Input Parameters
    - long: "iTendonType"
      short: "iTEND_TYPE"
      label: "Tendon Type"
      
    - long: "iCorrosiveCondition"
      short: "iCORR_COND"
      label: "Corrosive Condition"
      
    - long: "iFlexuralStrength"
      short: "iFLEX_STR"
      label: "Flexural Strength"
      
    - long: "iExposureFactor"
      short: "iEXP_FACT"
      label: "Exposure Factor for Crack Width"
      
    - long: "dExposureFactorValue"
      short: "dEXP_VAL"
      label: "User Exposure Factor Value"
      
    - long: "iConstructionType"
      short: "iCONSTR_TYPE"
      label: "Construction Type"
      
    - long: "sDesignCode"
      short: "sDES_CODE"
      label: "Design Code"

# ============================================================================
# OUTPUT - ì¶œë ¥ ê·œì¹™
# ============================================================================
output:
  # íŒŒì¼ëª… ê·œì¹™
  filename:
    case: "UPPER_SNAKE"      # ëŒ€ë¬¸ì ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤
    extension: ".json"
  
  # ë©”íƒ€ë°ì´í„° í¬í•¨
  meta:
    enabled: true
    fields:
      - "rulesVersion"
      - "specVersion"
      - "sourceHash"
      - "outputHash"
      - "generatedAt"
      - "appliedRuleIds"
      - "warnings"
      - "unknownKeys"
  
  # ë³„ë„ meta.json íŒŒì¼ ìƒì„±
  separateMetaFile: false    # trueë©´ SCHEMA_NAME.meta.json ìƒì„±

# ============================================================================
# TOOL CONTRACT - MCP ë„êµ¬ ê³„ì•½
# ============================================================================
toolContract:
  # save_schema ë„êµ¬
  saveSchema:
    requiredParams:
      - schemaName
      - schema
    optionalParams:
      - description
      - outputDir
      - questions
      - skipValidation
    
    # ì§ˆë¬¸ í•„ë“œ ì •ì±…
    questions:
      maxItems: 10
      requiredFields:
        - field
        - question
      optionalFields:
        - context
        - suggestion

# ============================================================================
# AUTO-QUESTION PATTERNS - ìë™ ì§ˆë¬¸ íŒ¨í„´ (AI ì°¸ì¡°ìš©)
# ============================================================================
# ğŸ“Œ AIê°€ ìŠ¤í‚¤ë§ˆ ìƒì„± ì‹œ ì•„ë˜ íŒ¨í„´ì„ ê°ì§€í•˜ë©´ ì‚¬ìš©ìì—ê²Œ ì§ˆë¬¸í•´ì•¼ í•¨
autoQuestionPatterns:
  # ğŸ”¥ ì¡°ê±´ë¶€ ì…ë ¥ í•„ë“œ íŒ¨í„´
  conditionalInput:
    description: |
      ë¼ë””ì˜¤/ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ì¤‘ "User", "Custom", "ì§ì ‘ ì…ë ¥" ë“±ì˜ ì˜µì…˜ì´ ìˆìœ¼ë©´
      í•´ë‹¹ ì˜µì…˜ ì„ íƒ ì‹œ í…ìŠ¤íŠ¸/ìˆ«ì ì…ë ¥ í•„ë“œê°€ í™œì„±í™”ë˜ëŠ”ì§€ ì§ˆë¬¸í•´ì•¼ í•¨
    triggers:
      - "User"
      - "Custom"
      - "Manual"
      - "ì§ì ‘ ì…ë ¥"
      - "ì‚¬ìš©ì ì •ì˜"
    question: |
      "{option}" ì˜µì…˜ì„ ì„ íƒí•˜ë©´ ë³„ë„ì˜ ì…ë ¥ í•„ë“œê°€ í™œì„±í™”ë˜ë‚˜ìš”?
      (ì˜ˆ: ìˆ«ì ì…ë ¥, í…ìŠ¤íŠ¸ ì…ë ¥)
    schemaPattern: |
      visibleWhen:
        field: "{parentField}"
        equals: {optionValue}
  
  # ğŸ”¥ TYPEë³„ ì¡°ê±´ë¶€ í•„ë“œ íŒ¨í„´
  typeConditionalFields:
    description: |
      TYPE ì„ íƒì— ë”°ë¼ ë³´ì´ëŠ”/ìˆ¨ê²¨ì§€ëŠ” í•„ë“œê°€ ìˆëŠ”ì§€ í™•ì¸
    question: |
      "{field}" í•„ë“œëŠ” íŠ¹ì • TYPEì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•œê°€ìš”?
      ì–´ë–¤ TYPEì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œì§€ ì•Œë ¤ì£¼ì„¸ìš”.
    schemaPattern: |
      x-required-by-type:
        TYPE1: true
        TYPE2: false
  
  # ğŸ”¥ ê·¸ë£¹/ì„¹ì…˜ í† ê¸€ íŒ¨í„´
  groupToggle:
    description: |
      íŠ¹ì • ì˜µì…˜ ì„ íƒ ì‹œ ì „ì²´ ê·¸ë£¹/ì„¹ì…˜ì´ í™œì„±í™”ë˜ëŠ” ê²½ìš°
    triggers:
      - "Enable"
      - "Use"
      - "í™œì„±í™”"
      - "ì‚¬ìš©"
    question: |
      "{option}" ì˜µì…˜ì„ ì„ íƒí•˜ë©´ ì¶”ê°€ ì„¤ì • ì˜ì—­ì´ í™œì„±í™”ë˜ë‚˜ìš”?
      ì–´ë–¤ í•„ë“œë“¤ì´ í™œì„±í™”ë˜ëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”.
  
  # ğŸ”¥ ê¸°ë³¸ê°’ ì—°ë™ íŒ¨í„´
  linkedDefaults:
    description: |
      í•œ í•„ë“œì˜ ì„ íƒì´ ë‹¤ë¥¸ í•„ë“œì˜ ê¸°ë³¸ê°’ì— ì˜í–¥ì„ ì£¼ëŠ” ê²½ìš°
    question: |
      "{field1}" ì„ íƒì— ë”°ë¼ "{field2}"ì˜ ê¸°ë³¸ê°’ì´ ë³€ê²½ë˜ë‚˜ìš”?
      
  # ğŸ”¥ Select All / Unselect All íŒ¨í„´
  bulkSelection:
    description: |
      "Select All", "Unselect All" ë²„íŠ¼ì´ ìˆëŠ” ì²´í¬ë°•ìŠ¤ ê·¸ë£¹
    triggers:
      - "Select All"
      - "Unselect All"
      - "ëª¨ë‘ ì„ íƒ"
      - "ëª¨ë‘ í•´ì œ"
    question: |
      ì´ ì²´í¬ë°•ìŠ¤ ê·¸ë£¹ì— "ëª¨ë‘ ì„ íƒ/í•´ì œ" ê¸°ëŠ¥ì´ í•„ìš”í•œê°€ìš”?
    note: |
      ì´ ê¸°ëŠ¥ì€ ìŠ¤í‚¤ë§ˆê°€ ì•„ë‹Œ UI ë Œë”ëŸ¬ì—ì„œ ì²˜ë¦¬ë¨

# ============================================================================
# EXAMPLE QUESTIONS - ì§ˆë¬¸ ì˜ˆì‹œ (AI ì°¸ì¡°ìš©)
# ============================================================================
exampleQuestions:
  - field: "iEXP_FACT"
    question: |
      "Exposure Factor for Crack Width"ì—ì„œ "User" ì˜µì…˜ì„ ì„ íƒí•˜ë©´ 
      ë³„ë„ì˜ ìˆ«ì ì…ë ¥ í•„ë“œê°€ í™œì„±í™”ë˜ë‚˜ìš”? ìˆë‹¤ë©´ ê¸°ë³¸ê°’ì€ ë¬´ì—‡ì¸ê°€ìš”?
    context: "ì´ë¯¸ì§€ì—ì„œ 'User' ì˜µì…˜ ì˜†ì— ì…ë ¥ í•„ë“œê°€ ë³´ì…ë‹ˆë‹¤"
    suggestion:
      addField: "dEXP_VAL"
      type: "number"
      default: 1
      visibleWhen:
        field: "iEXP_FACT"
        equals: 2  # User ì˜µì…˜ì˜ ê°’
        
  - field: "STYPE"
    question: |
      "Element Subtype"ì€ ëª¨ë“  TYPEì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œê°€ìš”?
      ì•„ë‹ˆë©´ íŠ¹ì • TYPEì—ì„œë§Œ ë³´ì´ë‚˜ìš”?
    context: "x-enum-by-typeì„ ë³´ë©´ ì¼ë¶€ TYPEì—ë§Œ ê°’ì´ ì •ì˜ë˜ì–´ ìˆìŒ"
    suggestion:
      usePattern: "x-required-by-type"


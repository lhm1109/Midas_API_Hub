# ============================================================================
# UI RULES - UI ë Œë”ë§ í†µí•© ê·œì¹™
# ============================================================================
# Builder/Table/HTML ë Œë”ë§ì„ ìœ„í•œ í†µí•© ê·œì¹™
# ê³µí†µ ê·œì¹™ì€ shared.yamlì—ì„œ ìƒì†
# ============================================================================

version: "1.0.0"
extends: "./shared.yaml"

# ============================================================================
# LAYOUT - ë ˆì´ì•„ì›ƒ ê³µí†µ ê·œì¹™
# ============================================================================
layout:
  # ì„¹ì…˜ í—¤ë” (x-ui.sectionId ê¸°ë°˜ - x-ui.group deprecated)
  sectionHeader:
    enabled: true
    icon: "ğŸ“‹"
    style:
      borderTop: "border-t-2 border-cyan-800/50"
      textColor: "text-cyan-400"
      fontSize: "text-sm"
      fontWeight: "font-semibold"
      padding: "pt-4 pb-2"
      firstSection:
        borderTop: false

  # í•„ë“œ ê·¸ë£¹í™”
  fieldGrouping:
    enabled: true
    groupBy: "x-ui.sectionId"  # ğŸ”¥ x-ui.group deprecated

  # ì¤‘ì²© ê°ì²´
  nestedObject:
    accordion: true
    checkbox: true
    style:
      border: "border-zinc-700"
      background: "bg-zinc-900/50"
      headerBackground: "bg-zinc-800/50"

# ============================================================================
# MARKER INTERPRETATION - x-* ë§ˆì»¤ UI í•´ì„ ê·œì¹™
# ============================================================================
# âš ï¸ í•µì‹¬ ì›ì¹™: x-* ë§ˆì»¤ëŠ” ìˆœìˆ˜ UI í‘œí˜„ìš©
#   - ì‚­ì œí•´ë„ ê²€ì¦ ë™ì‘ì— ì˜í–¥ ì—†ìŒ
#   - ê²€ì¦ ë¡œì§ì€ í‘œì¤€ JSON Schema (allOf if/then) ì‚¬ìš©
#
# ì´ ì„¹ì…˜ì€ UIê°€ ê° x-* ë§ˆì»¤ë¥¼ ì–´ë–»ê²Œ í•´ì„í•˜ê³  ë Œë”ë§í• ì§€ ì •ì˜
# ============================================================================
markerInterpretation:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # x-ui: í•„ë“œ ë©”íƒ€ë°ì´í„° (label, hint, groupId)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  x-ui:
    enabled: true
    purpose: "í•„ë“œ ë¼ë²¨, íŒíŠ¸, ê·¸ë£¹ ë“± UI ë©”íƒ€ë°ì´í„°"
    rendering:
      label:
        source: "x-ui.label"
        fallback: "key"  # x-ui.label ì—†ìœ¼ë©´ í•„ë“œ í‚¤ ì‚¬ìš©
        style: { fontWeight: "font-medium", color: "text-zinc-200" }
      hint:
        source: "x-ui.hint"
        position: "below"
        style: { color: "text-amber-400", fontSize: "text-[10px]", icon: "ğŸ’¡" }
      groupId:
        source: "x-ui.groupId"
        useFor: "section-grouping"
      sectionId:
        source: "x-ui.sectionId"
        fallback: "SECTION_GENERAL"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # x-enum-labels: enum ê°’ì— ëŒ€í•œ ë¼ë²¨
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  x-enum-labels:
    enabled: true
    purpose: "enum ê°’ì— ëŒ€ì‘í•˜ëŠ” UI ë¼ë²¨"
    rendering:
      format: "value - label"
      display: "select-options"  # Select ì»´í¬ë„ŒíŠ¸ì—ì„œ í‘œì‹œ
      tableDisplay: "list"       # í…Œì´ë¸”ì—ì„œ ë¦¬ìŠ¤íŠ¸ë¡œ í‘œì‹œ

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # x-enum-labels-by-type: TYPEë³„ enum ë¼ë²¨
  # âš ï¸ ì‹¤ì œ enum ê°’ ëª©ë¡ì€ allOf[].if.then.properties.*.enumì—ì„œ ê°€ì ¸ì˜´
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  x-enum-labels-by-type:
    enabled: true
    purpose: "TYPE ì¡°ê±´ì— ë”°ë¥¸ enum ë¼ë²¨ (UI í‘œì‹œìš©ë§Œ)"
    triggerField: "TYPE"
    rendering:
      format: "value - label"
      dynamicUpdate: true  # TYPE ë³€ê²½ ì‹œ ë¼ë²¨ ë™ì  ì—…ë°ì´íŠ¸
      tableDisplay: "grouped-by-type"
    note: |
      ì‹¤ì œ enum ê°’ ëª©ë¡ì€ ìŠ¤í‚¤ë§ˆì˜ allOf[].if.thenì—ì„œ ì½ì–´ì˜´
      ì´ ë§ˆì»¤ëŠ” ë¼ë²¨ë§Œ ì œê³µ

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # x-uiRules: UI ê°€ì‹œì„±/ë™ì‘ ê·œì¹™
  # âš ï¸ ê²€ì¦ì€ allOf if/then, ì´ê²ƒì€ ìˆœìˆ˜ UI ê°€ì‹œì„±
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  x-uiRules:
    enabled: true
    purpose: "í•„ë“œ ê°€ì‹œì„± ì¡°ê±´ (UI only)"
    conditions:
      visibleWhen:
        description: "ì§€ì •ëœ ì¡°ê±´ ì¶©ì¡± ì‹œ í•„ë“œ í‘œì‹œ"
        hideMode: "remove"  # ì¡°ê±´ ë¶ˆì¶©ì¡± ì‹œ DOMì—ì„œ ì œê±°
        evaluateOn: "change"

# ============================================================================
# LEGACY COMPATIBILITY - ë ˆê±°ì‹œ ë§ˆì»¤ í˜¸í™˜ (deprecated)
# ============================================================================
# âš ï¸ ì•„ë˜ ë§ˆì»¤ë“¤ì€ deprecatedì´ë©° ìƒˆ ìŠ¤í‚¤ë§ˆì—ì„œ ì‚¬ìš© ê¸ˆì§€
# ê¸°ì¡´ ìŠ¤í‚¤ë§ˆ í˜¸í™˜ì„ ìœ„í•´ UIì—ì„œ ì—¬ì „íˆ ì½ì§€ë§Œ, ìƒˆë¡œ ì‘ì„± ì‹œ
# í‘œì¤€ allOf if/then + x-optional-when ì‚¬ìš© ê¶Œì¥
legacyMarkers:
  x-required-by-type:
    deprecated: true
    migrateTo: "allOf[].if.then.required"
    uiInterpretation: "Required ìƒíƒœ í‘œì‹œì— ì‚¬ìš©, ìƒˆ ìŠ¤í‚¤ë§ˆëŠ” allOf ì‚¬ìš©"
  x-enum-by-type:
    deprecated: true
    migrateTo: "allOf[].if.then.properties.*.enum"
    uiInterpretation: "ë™ì  enum í‘œì‹œì— ì‚¬ìš©, ìƒˆ ìŠ¤í‚¤ë§ˆëŠ” allOf + x-enum-labels-by-type ì‚¬ìš©"
  x-node-count-by-type:
    deprecated: true
    migrateTo: "allOf[].if.then.properties.NODE.minItems/maxItems"
    uiInterpretation: "ë…¸ë“œ ê°œìˆ˜ íŒíŠ¸ í‘œì‹œì— ì‚¬ìš©, ìƒˆ ìŠ¤í‚¤ë§ˆëŠ” allOf ì‚¬ìš©"
  # âœ… x-required-when, x-optional-whenì€ í˜„ì¬ ì‹œìŠ¤í…œì˜ í‘œì¤€
  x-required-when:
    deprecated: false
    purpose: "ì¡°ê±´ë¶€ í•„ìˆ˜ - ì¡°ê±´ ë§Œì¡± ì‹œ í•„ìˆ˜ + í‘œì‹œ"
    uiInterpretation: "Conditional(í•„ìˆ˜) ìƒíƒœ í‘œì‹œ + ì¡°ê±´ë³„ ê·¸ë£¹í™”"
  x-optional-when:
    deprecated: false
    purpose: "ì¡°ê±´ë¶€ ì„ íƒ - ì¡°ê±´ ë§Œì¡± ì‹œ ì„ íƒ + í‘œì‹œ"
    uiInterpretation: "Conditional(ì„ íƒ) ìƒíƒœ í‘œì‹œ + ì¡°ê±´ë³„ ê·¸ë£¹í™”"

# ============================================================================
# RENDERING - ë Œë”ë§ ê³µí†µ ê·œì¹™
# ============================================================================
rendering:
  requiredIndicator:
    enabled: true
    symbol: "*"
    color: "text-red-400"

  description:
    enabled: true
    source: "x-ui.label"
    fallback: "key"
    position: "inline"
    style:
      color: "text-zinc-200"
      fontSize: "text-sm"

  typeIndicator:
    enabled: true
    position: "right"
    style:
      color: "text-zinc-600"
      fontSize: "text-[10px]"
      fontFamily: "font-mono"

  hintDisplay:
    enabled: true
    position: "below"
    sources:
      - "x-ui.hint"
      - "x-value-constraint"
      - "x-node-count-by-type"
    style:
      color: "text-amber-400"
      fontSize: "text-[10px]"
      fontStyle: "italic"
      icon: "ğŸ’¡"

# ============================================================================
# VALIDATION DISPLAY - ê²€ì¦ í‘œì‹œ
# ============================================================================
validation:
  standard:
    enabled: true
    badge: "STD"
    badgeColor: "bg-blue-900/50 text-blue-300 border-blue-700/50"

  appLayer:
    enabled: true
    badge: "APP"
    badgeColor: "bg-orange-900/50 text-orange-300 border-orange-700/50"

  errorDisplay:
    position: "below"
    style:
      color: "text-red-400"
      fontSize: "text-xs"
      icon: "âŒ"

  warningDisplay:
    position: "below"
    style:
      color: "text-yellow-400"
      fontSize: "text-xs"
      icon: "âš ï¸"

# ============================================================================
# BUILDER SPECIFIC - Builder íƒ­ ì „ìš©
# ============================================================================
builder:
  formLayout:
    container:
      className: "bg-gradient-to-br from-purple-950/50 to-zinc-900 border-2 border-purple-800/50 rounded-lg p-6"
    title:
      text: "Schema-Based Fields"
      icon: "ğŸ“"
    fieldContainer:
      className: "space-y-4"

  fieldRendering:
    standard:
      label:
        source: "description"
        fallback: "name"
        showRequired: true
        showType: true
      input:
        className: "bg-zinc-800 border-zinc-700"

    enum:
      component: "Select"
      dynamic: true
      triggerField: "TYPE"

    array:
      component: "Textarea"
      parseJson: true
      showHint: true

    object:
      accordion: true
      checkbox: true
      expandByDefault: false

  dynamicBehavior:
    conditionalVisibility:
      enabled: true
      autoDetect: true
      evaluateOn: "change"
      hideMode: "remove"

    dynamicEnum:
      enabled: true
      triggerField: "TYPE"
      preserveValue: false

    dynamicRequired:
      enabled: true
      triggerField: "TYPE"

  instanceManagement:
    enabled: true
    wrapper: "Assign"
    defaultInstance: "1"

  jsonPreview:
    enabled: true
    modes:
      - "annotated"
      - "monaco"
    defaultMode: "annotated"

# ============================================================================
# TABLE SPECIFIC - Table (Spec) íƒ­ ì „ìš©
# ============================================================================
table:
  # ìŠ¤í‚¤ë§ˆ í™•ì¥ í•„ë“œ ì¶”ì¶œ ê·œì¹™
  # âš ï¸ ìˆœìˆ˜ UI ë§ˆì»¤ë§Œ (shared.yaml SSOT ê¸°ì¤€)
  # ê²€ì¦ ë§ˆì»¤(x-enum-by-type, x-node-count-by-type, x-required-by-type)ëŠ” 
  # allOf[].if.thenìœ¼ë¡œ ëŒ€ì²´ë˜ì–´ ì œê±°ë¨
  schemaExtensions:
    extractFromSchema:
      - { key: "x-ui", targetProperty: "ui", transformKey: true }
      - { key: "x-enum-labels", targetProperty: "enumLabels", transformKey: true }
      - { key: "x-enum-labels-by-type", targetProperty: "enumLabelsByType", transformKey: true }
      - { key: "x-transport", targetProperty: "x-transport", passthrough: true }

  # í…Œì´ë¸” êµ¬ì¡°
  structure:
    columns:
      - { id: "no", header: "No.", width: "6%", align: "center" }
      - { id: "description", header: "Description", width: "35%", align: "left" }
      - { id: "key", header: "Key", width: "14%", align: "left" }
      - { id: "type", header: "Value Type", width: "10%", align: "center" }
      - { id: "default", header: "Default", width: "10%", align: "center" }
      - { id: "required", header: "Required", width: "25%", align: "left" }

    numbering:
      start: 1
      resetOnSection: false

  # í–‰ ë Œë”ë§
  rowRendering:
    description:
      source: "x-ui.label"
      fallback: "key"
      markdown: true
      features:
        enum:
          enabled: true
          title: "**Enum Values:**"
          format: "â€¢ {value} - {label}"
        enumByType:
          enabled: true
          title: "**Enum Values by Type:**"
        valueConstraint:
          enabled: true
          title: "**Value Constraints:**"
          badge: "APP"
        nodeCountByType:
          enabled: true
          title: "**Node Count by Type:**"
          badge: "APP"
        valueHintsByType:  # ğŸ”¥ NEW: TYPEë³„ ê°’ íŒíŠ¸ í‘œì‹œ
          enabled: true
          title: "**ğŸ’¡ Value Hints by Type:**"
          style: "hint"  # íŒíŠ¸ ìŠ¤íƒ€ì¼ (amber ìƒ‰ìƒ)

    key:
      format: "\"{key}\""
      style:
        color: "text-blue-400"
        fontFamily: "font-mono"

    required:
      dynamicByType: true

  # ì¤‘ì²© í•„ë“œ
  nestedFields:
    enabled: true
    expandable: true
    expandIcon: "â–¼"
    collapseIcon: "â–¶"
    style:
      indentation: "pl-8"
      background: "bg-zinc-900/50"
      keyColor: "text-amber-400"

# ============================================================================
# STYLING - ì „ì—­ ìŠ¤íƒ€ì¼
# ============================================================================
styling:
  colors:
    primary: "blue-600"
    secondary: "cyan-600"
    success: "green-600"
    error: "red-600"
    warning: "amber-600"
    section: "cyan-400"

  spacing:
    fieldGap: "4"
    sectionGap: "6"

  borders:
    fieldBorder: "border-zinc-700"
    sectionBorder: "border-cyan-800/50"

# ============================================================================
# VALIDATION MESSAGES - ê²€ì¦ ë©”ì‹œì§€ í…œí”Œë¦¿
# ============================================================================
validationMessages:
  required: "{field} is required for {TYPE}"
  invalidType: "{field} must be a {type}"
  invalidEnum: "{field} must be one of: {values} (for {TYPE})"
  minItems: "{field} must have at least {min} items"
  maxItems: "{field} must have at most {max} items"
  nodeCount: "{field} must have {count} nodes for {TYPE}"
  valueConstraint: "{field}: {constraint}"

# ============================================================================
# FALLBACK UI - í´ë°± ë Œë”ë§ (missing x-ui ì²˜ë¦¬)
# ============================================================================
fallbackUI:
  # x-ui ì—†ëŠ” í•„ë“œ ì²˜ë¦¬
  missingXui:
    label:
      source: "key"
      transform: "humanize"  # "iTENDON_TYPE" â†’ "I Tendon Type"
    sectionId: "SECTION_GENERAL"  # ğŸ”¥ sectionRegistry.id ì°¸ì¡°
    component: "Input"
    warn: true

  # ì•Œ ìˆ˜ ì—†ëŠ” íƒ€ì… ì²˜ë¦¬
  unknownType:
    component: "Textarea"
    props:
      placeholder: "Enter value as JSON"
    warn: true

# NOTE: tableSchemaRegistry moved to shared.yaml for SSOT
# See: schema_definitions/civil_gen_definition/enhanced/shared.yaml â†’ tableSchemaRegistry
